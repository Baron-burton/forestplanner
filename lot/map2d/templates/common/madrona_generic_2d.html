<html>
<head>
<link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.4.0/bootstrap.min.css">
<style type="text/css">
      body {
        padding-top: 60px;
      }
      .sidebar {
          left: 10px !important;
          width: 400px !important;
      }
      .content {
          margin-left: 410px !important; /* 400 + 10 */
      }
 
    #map {
        width: 100%;
        height: 98%;
        border: 1px solid #ccc;
    }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script type="text/javascript" src="http://twitter.github.com/bootstrap/1.4.0/bootstrap-dropdown.js"></script>
<script type="text/javascript" src="http://twitter.github.com/bootstrap/1.4.0/bootstrap-tabs.js"></script>
<script type="text/javascript" src="http://twitter.github.com/bootstrap/1.4.0/bootstrap-modal.js"></script>
<script src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script>
<script src="/media/OpenLayers.js"></script>


<script>
$(document).ready(function() {
   $('.topbar').dropdown();
   $('.tabs').tabs()
});
</script>

    <script type="text/javascript">
        var map, controls;
        var stands;
        var currentStep = 1;
        var steps = [undefined]; // start with a blank to make it 1-indexed

        function toggleControl(element) {
            for(key in controls) {
                var control = controls[key];
                if(element.value == key && element.checked) {
                    control.activate();
                } else {
                    control.deactivate();
                }
            }
        }

        function init() {
            map = new OpenLayers.Map('map');
            map.addControl(new OpenLayers.Control.LayerSwitcher());
            
            var gphy = new OpenLayers.Layer.Google( "Google Physical", {type: google.maps.MapTypeId.TERRAIN});
            var ghyb = new OpenLayers.Layer.Google( "Google Hybrid", {type: google.maps.MapTypeId.HYBRID, numZoomLevels: 20});
            var gsat = new OpenLayers.Layer.Google( "Google Satellite", {type: google.maps.MapTypeId.SATELLITE, numZoomLevels: 22});

            var arrayOSM = ["http://otile1.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg",
                        "http://otile2.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg",
                        "http://otile3.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg",
                        "http://otile4.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg"];
            var arrayAerial = ["http://oatile1.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg",
                            "http://oatile2.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg",
                            "http://oatile3.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg",
                            "http://oatile4.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg"];
            
            var baseOSM = new OpenLayers.Layer.OSM("MapQuest-OSM Tiles", arrayOSM);
            var baseAerial = new OpenLayers.Layer.OSM("MapQuest Open Aerial Tiles", arrayAerial);
        
            map.addLayers([gsat, gphy, ghyb]);
            map.addLayer(baseOSM);
            map.addLayer(baseAerial);

            map.setCenter(new OpenLayers.LonLat(-124.38, 42.8).transform(
                new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject()), 13);
            
            for (var i=map.layers.length-1; i>=0; --i) {
                map.layers[i].animationEnabled = false;
            };

            // Add stands
            var renderer = OpenLayers.Util.getParameters(window.location.href).renderer;
            renderer = (renderer) ? [renderer] : OpenLayers.Layer.Vector.prototype.renderers;
            var styles = new OpenLayers.StyleMap({
                "default": new OpenLayers.Style(null, {
                    rules: [
                        new OpenLayers.Rule({
                            symbolizer: {
                                "Polygon": {
                                    fillColor: "#00ccff",
                                    fillOpacity: 0.25,
                                    strokeWidth: 0.25,
                                    strokeOpacity: 1,
                                    strokeColor: "white"
                                }
                            }
                        })
                    ]
                }),
                "select": new OpenLayers.Style({
                    strokeColor: "#00ccff",
                    strokeWidth: 4
                }),
                "temporary": new OpenLayers.Style(null, {
                    rules: [
                        new OpenLayers.Rule({
                            symbolizer: {
                                "Point": {
                                    pointRadius: 5,
                                    fillColor: "#ffcc00",
                                },
                                "Polygon": {
                                    pointRadius: 5,
                                    fillColor: "white",
                                    fillOpacity: 0.25,
                                    strokeWidth: 1,
                                    strokeOpacity: 1,
                                    strokeColor: "#ffcc00"
                                },
                            }
                        })
                    ]
                })
            });
            stands = new OpenLayers.Layer.Vector("Stands", 
                    {
                        renderers: renderer, 
                        styleMap: styles,
                    }
            );
            map.addLayer(stands);

            var draw = new OpenLayers.Control.DrawFeature(stands, OpenLayers.Handler.Polygon);
            map.addControl(draw);
            draw.activate();
 
            // Ctl-Z to undo, Ctl-Y to redo, Esc to cancel
            OpenLayers.Event.observe(document, "keydown", function(evt) {
                var handled = false;
                switch (evt.keyCode) {
                    case 90: // z
                        if (evt.metaKey || evt.ctrlKey) {
                            draw.undo();
                            handled = true;
                        }
                        break;
                    case 89: // y
                        if (evt.metaKey || evt.ctrlKey) {
                            draw.redo();
                            handled = true;
                        }
                        break;
                    case 27: // esc
                        draw.cancel();
                        handled = true;
                        break;
                }
                if (handled) {
                    OpenLayers.Event.stop(evt);
                }
            });

            // configure the snapping agent
            var snap = new OpenLayers.Control.Snapping({
                layer: stands,
                defaults: {
                    nodeTolerance: 10,
                    vertexTolerance: 10,
                    edgeTolerance: 3 
                },
                greedy: true
            });
            map.addControl(snap);
            snap.activate();

            var geojson_format = new OpenLayers.Format.GeoJSON();
            $.ajax({
                url: "/trees/stands_json/", 
                type: 'GET',
                success: function(data) {
                    stands.addFeatures(geojson_format.read(data));
                },
                dataType: 'json',
                async: true
            })
            .error( function(e) { 
                console.log(e);
                alert("An error occured trying to record stand data... Please try again."); 
                continue_steps = false;
            });

        }; //end init

        $(init);
    </script>
</head>
<body>

    <div class="topbar" data-dropdown="dropdown">
      <div class="topbar-inner">
        <div class="container-fluid">
          <a class="brand" href="#">Madrona 2D</a>
          <ul class="nav">
            <li class="active"><a href="#">Map</a></li>
            <li><a href="#">About</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle">Help</a>
              <ul class="dropdown-menu">
                <li><a href="#">Secondary link</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li><a href="#">Another link</a></li>
              </ul>
            </li>
          </ul>

          <ul class="nav secondary-nav">
            <li><a href="#" data-controls-modal="modal-register" data-backdrop="static">Register</a></li>
            <div id="modal-register" class="modal hide fade">
                <div class="modal-header">
                    <a href="#" class="close">&times;</a>
                    <h3>Register</h3>
                </div>
                <div class="modal-body">

                    <form method="post" action="/accounts/signin/" name="auth_form" id="auth_form">
                        <input type="hidden" value="" name="next">
                        <fieldset>
                            <legend><strong>Register for an account</strong></legend> 

                            <div><label for="id_username">Username</label>
                            <br/><input type="text" maxlength="30" name="username" id="id_username"></div>

                            <div><label for="id_password">Password</label>
                            <br/><input type="password" id="id_password" name="password"></div>
                        </fieldset> 
                    </form>
                </div>  

                <div class="modal-footer">
                    <a href="#" class="btn primary">Register</a>
                </div>
            </div>
            <li><a href="#" data-controls-modal="modal-login" data-backdrop="static">Login</a></li>
            <div id="modal-login" class="modal hide fade">

                <form method="post" action="/accounts/signin/" name="auth_form" id="auth_form">
                <div class="modal-header">
                    <a href="#" class="close">&times;</a>
                    <h3>Sign In</h3>
                </div>
                <div class="modal-body">

                        <input type="hidden" value="/map2d" name="next">
                        <fieldset>
                            <legend><strong>Sign In To Madrona</strong></legend> 

                            <div><label for="id_username">Username</label>
                            <br><input type="text" maxlength="30" name="username" id="id_username"></div>

                            <div><label for="id_password">Password</label>
                            <br><input type="password" id="id_password" name="password"></div>

                        </fieldset> 

                    <p><a href="/accounts/password/reset/" class="panel_link">Forgot your password?</a></p>
                </div>  
                <div class="modal-footer">
                    <input type="submit" class="btn primary" value="Sign in" name="blogin">
                </div>
                </form>
            </div>
          </ul>
        </div>
      </div><!-- /topbar-inner -->
    </div><!-- /topbar -->



<!-- ////////////////////////////////////////////// -->
 <div class="container-fluid">
      <div class="sidebar">
        <ul class="tabs" data-tabs="tabs">
          <li class="active"><a href="#tab_my">My Features</a></li>
          <li><a href="#tab_shared">Collaboration</a></li>
          <li><a href="#tab_data">Base Data</a></li>
          <li><a href="#tab_tools">Tools</a></li>
        </ul>
        <div class="tab-content">
            <div class="active" id="tab_my">

          <h4>My Features and Collections</h4>
          <p>
            <a class="btn">Create New<!-- &raquo; --></a>
            <a class="btn">Attributes<!-- &raquo; --></a>
            <a class="btn">Edit<!-- &raquo; --></a>
          </p>

            </div>
            <div id="tab_shared">
                <h4>Shared Features and Collections</h4>
                <p><a class="btn">Learn more &raquo;</a></p>
            </div>
            <div id="tab_data">
                <h4>Base maps</h4>
                <p><a class="btn">Learn more &raquo;</a></p>
                <h4>Overlays</h4>
                <p><a class="btn">Learn more &raquo;</a></p>
            </div>
            <div id="tab_tools">
                <h4>Tools</h4>
                <h5> Search  </h5>
                <div>
                    <form class="pull-left" action="">
                        <input type="text" placeholder="Search">
                    </form>
                    <p><a class="btn"> Fly To &raquo;</a></p>
                </div>

            </div>
        </div>
      </div>
      <div class="content">
        <div class="themap">
            <div id="map"></div>
            <div class="loading"></div>
        </div>

      </div>
    </div>


</div>

</body>
</html>

