{% extends 'common/base.html' %}
{% load url from future %}

{% block content %}
        <div class="row-fluid">
          <div class="span5">
              <div data-bind="visible: breadcrumbs.length > 0">
                <ul id="breadcrumbs" class="breadcrumb" data-bind="foreach: breadcrumbs">
                    <li data-bind="visible: ! $parent.isLast($data)">
                        <a data-bind="text: name, click: action"></a>
                        <span class="divider">/</span>
                    </li>
                    <li class="active" data-bind="visible: $parent.isLast($data)">
                        <span data-bind="text: name"></span>
                    </li>
                </ul>
            </div>
            <div id="home-html" class="well">
                <div style="width: 100%; text-align: center;">
                    <h3>An online tool for forest management and scenario planning</h3>
                </div>

                <div class="img-polaroid">
                    <div id="myCarousel" class="carousel slide">
                        <div class="carousel-inner" style="max-height: 440px;">
                            <div class="item active">
                                <img src="/media/img/forest_photos/garibaldi.jpg"/>
                            </div>
                            <div class="item">
                                <img src="/media/img/forest_photos/jedsmith.jpg"/>
                            </div>
                            <div class="item">
                                <img src="/media/img/forest_photos/drift_creek.jpg"/>
                            </div>
                        </div>
                    <a class="left carousel-control" href="#myCarousel" data-slide="prev">‹</a>
                    <a class="right carousel-control" href="#myCarousel" data-slide="next">›</a>
                    </div>
                </div>

                <div style="margin: 16px;">
                    <p>
                        &nbsp;&nbsp;&nbsp;&nbsp;Ecotrust is developing online software that will give all Oregon and Washington 
                        land managers forest managment scenario planning capacity. You will be able to <strong>visualize 
                            alternative management scenarios</strong> on your lands and receive immediate feedback on <strong>how  
                            decisions might pay off</strong> in terms of timber harvests and financial returns, as well as 
                        <strong>public benefits</strong> like carbon storage and ecosystem services.
                    </p>
                    
                    <p>
                    {% if not user.is_authenticated %}
                    <div class="btn-group pull-right">
                        <!-- <a class="btn btn-large" href="{% url 'registration_register' %}" id="register">Register</a> -->
                        <a class="btn btn-large" href="{% url 'account_login' %}" id="signin">Log In</a>
                    </div>
                    {% else %}
                    <a class="btn btn-large btn-success pull-right manage-your-properties" href="#">Manage Your Properties</a>
                    <div class="clearfix"></div>
                    {% endif %}
                    </p>                
                </div>
            </div>

            {% if user.is_authenticated %}
            <div id="property-html" data-bind="visible: showPropertyPanels" > 
                <div class="modal" id="delete-dialog" style="display:none">
                    <div class="modal-header">
                        <a class="close" data-dismiss="modal">×</a>
                        <h3>Delete Property</h3>
                    </div>
                    <div class="modal-body">
                        <div data-bind="if: selectedProperty()">
                            Are you sure you want to delete "<span data-bind="text: selectedProperty().name"></span>"?
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="#" class="btn" data-dismiss="modal">cancel</a>
                        <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Property</a>
                    </div>
                </div>
                <div class="well" style="display:none;" data-bind="visible: propertyList().length === 0"> 
                    <!-- data-bind="if: showNoPropertiesHelp"> -->
                    <h2>Create Properties</h2>
                    <p><em>You currently have no properties under management.</em></p>
                    <div id="properties-none">
                        <p>When your property is in view on the map, click the button below to draw the boundaries of your first property.</p>
                        <div class="pull-right">
                            <button href="#" class="btn" data-bind="click: startUpload, disable: preventUpdates">
                                <i class="icon-upload"></i> Upload GIS Data</button>
                            <button href="#" class="btn btn-success" 
                                data-bind="click: startAddDrawing, disable: preventUpdates">Draw Property Boundary</button>
                        </div>
                    </div> <!-- no properties -->
                </div><!-- end of no properties -->
				<div id="properties-list" style="display: none;" class="row-fluid" data-bind="visible: propertyList().length > 0">
					<div class="btn-group">
						<a class="btn" href="#">Property List</a>
						<a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><span class="caret"></span></a>
						<ul class="dropdown-menu">
							<!-- ko foreach: propertyList -->
							<li data-bind="click: $parent.selectProperty, css: { active: $data === $parent.selectedProperty() }">
								<a data-bind="text: name"></a>
							</li>
							<!-- /ko -->
							<li class="divider" data-bind="visible: propertyList().length"></li>
							<li>
								<a href="#" data-bind="click: startAddDrawing, disable: preventUpdates">
									<i class="icon-plus-sign"></i> Draw New Property
								</a>
							</li>
							<li>
								<a href="#" data-bind="click: startUpload, disable: preventUpdates">
									<i class="icon-upload"></i> Upload GIS Data
								</a>
							</li>
							<li class="divider"></li>
							<li>
								<a href="#" data-bind="click: zoomToExtent, disable: preventUpdates">
									<i class="icon-resize-full"></i> Show All
								</a>
							</li>
						</ul>
					</div>
				</div>
				<div class="row-fluid property-details">
						<div data-bind="if: selectedProperty()">
							<h3>Property Details: <i data-bind="text: selectedProperty().name"></i></h3>
					<div style="display: none;" class=" well" 
						data-bind="if: showDetailPanel, visible: showDetailPanel">
						<div class="pull-right btn-group">
						  <button href="#" id="delete-button" class="btn btn-mini" 
							  data-bind="click: showDeleteDialog"><i class="icon-remove"></i> Delete </button>
						  <button class="btn btn-mini" href="#" 
							  data-bind="click: showEditForm, disable: preventUpdates">
							  <i class="icon-edit"></i> Edit </button>
						</div>


							<dl class="dl-horizontal">
								<dt>Area</dt>
								<dd><span data-bind="text: selectedProperty().acres()"></span> acres</dd>
								<dt>Location</dt>
								<dd data-bind="foreach: selectedProperty().location">
									<span data-bind="text: $data"></span><!-- ko if: $index() == 0 -->, <!-- /ko -->
								</dd>
								<dt>Number of Stands</dt>
								<dd>
									<span data-bind="text: selectedProperty().stand_summary.with_strata"></span> 
									of <span data-bind="text: selectedProperty().stand_summary.total"></span> with strata 
								</dd>
								<dd>
									<span data-bind="text: selectedProperty().stand_summary.with_condition"></span> 
									of <span data-bind="text: selectedProperty().stand_summary.total"></span> with condition 
								</dd>
								<dd>
									<span data-bind="text: selectedProperty().stand_summary.with_terrain"></span> 
									of <span data-bind="text: selectedProperty().stand_summary.total"></span> with terrain 
								</dd>
							</dl>

							<div class="row-fluid">
								<div class="span4">
									<button class="btn pull-right btn-success" href="#" 
										data-bind="click: manageStands">
									<i class="icon-adjust icon-white"></i> Define Stand Boundaries</button>
								</div>
								<div class="span4">
									<a class="btn pull-right btn-success"  
										data-bind="attr: { href: '/trees/strata/' + selectedProperty().uid() }">
									<i class="icon-repeat icon-white"></i> Define Stand Groups</a>
								</div>
								<div class="span4">
									<button class="btn pull-right btn-success" href="#" data-bind="click: manageScenarios, 
									  css: {disabled: selectedProperty().stand_summary.with_condition() < selectedProperty().stand_summary.total()}">
									<i class="icon-repeat icon-white"></i> Evalutate Future Scenarios</button>
								</div>
							</div>
						</div>
					</div>
				</div>

                <div class="row-fluid"><!-- panels -->
                  <div>
                    <div style="display:none" data-bind="visible: showUploadPanel">
                      <h2>Upload stands</h2>
                      <p> File upload </p>
                      <ul> 
                          <li> A .zip file containing an ESRI Shapefile </li>
                          <li> Projected to Web Mercator </li>
                          <li> Contains polygons of all stands </li>
                          <li> Must contain an string attribute field called <em>name</em> or <em>STAND_ID</em> </li>
                      </ul>
                      <div class="well">
                      <form id="uploadForm" action="{% url 'trees-upload_stands' %}" method="post" enctype="multipart/form-data"> 
                            <input type="hidden" name="MAX_FILE_SIZE" value="100000">
                            <p> 
                                <label for="upload-propertyname">
                                    <span id="upload-propertyname-required" class="label label-important"
                                        style="display:none;"> 
                                        Required 
                                        <i class="icon-exclamation-sign icon-white"></i> 
                                    </span>
                                    &nbsp; New Property Name
                                </label>
                                <input type="text" id="upload-propertyname" name="new_property_name" size="10"/>
                            </p>
                            <p> 
                                <span id="upload-file-required" class="label label-important"
                                    style="display:none;"> 
                                    Required 
                                    <i class="icon-exclamation-sign icon-white"></i> 
                                </span>
                                <input type="file" id="upload-file" name="ogrfile" size="10"/> 
                            </p>
                            <div class="pull-right">
                                <a href="#" class="btn" data-bind="click: cancelUpload">Cancel</a>
                                <input id="uploadbutton" type="submit" class="btn btn-success" value="Upload"/>
                            </div>
                      </form>
                      <div id="uploadProgress" style="display: none; width:80%;" class="progress progress-striped active">
                        <div class="bar" style="width: 0%;"></div>
                      </div>
                      <div id="uploadResponse" style="width: 80%; font-size: 125%;"></div>
                      </div>
                    </div>
                    <div style="display:none" data-bind="if: showDrawHelpPanel, visible: showDrawHelpPanel">
                      <h2>Draw Property Boundary</h2>
                      <p> Double-click to complete polygon. </p>
                      <div class="pull-right">
                        <a href="#" class="btn" data-bind="click: cancelEdit">Cancel</a>
                      </div>
                    </div>

                    <div class="form-panel" style="display: none" data-bind="if: showEditPanel, visible: showEditPanel">
                      <h2>Edit Property</h2>
                      <div id="edit-panel"></div>
                      <div class="pull-right" id="edit-panel-buttons">
                        <a href="#" class="btn" data-bind="click: cancelEdit">Cancel</a>
                        <a href="#" class="btn btn-success" data-bind="click: updateFeature">Save changes</a>
                      </div>
                    </div>
                    <div class="form-panel" style="display:none" data-bind="if: showCreatePanel, visible: showCreatePanel">
                      <h2>Create Property</h2>
                      <div id="create-panel"></div>
                      <div class="pull-right" id="create-panel-buttons">
                        <a href="#" class="btn" data-bind="click: cancelEdit">Cancel</a>
                        <a href="#" class="btn btn-success" data-bind="click: addFeature">Create</a>
                      </div>
                    </div>
                  </div>
              </div>
            </div>
            <!-- end of property pages -->

            <div id="scenario-html" style="display: none" data-bind="visible: showScenarioPanels, if: showScenarioPanels">
				<!--
				<p class="info text-info well well-small clearfix">
					<i class="icon-info-sign"></i> Scenarios are rad.
				</p>
				-->
              <div class="row-fluid" data-bind="visible: showScenarioList">
				  <!--
                <div class="span12 well">
                    <h3>Scenario List</h3>
                    <p>
                    </p>
                    <div>
                        <ul class="nav nav-tabs nav-stacked" data-bind="foreach: scenarioList">
                            <li data-bind="click: $parent.toggleFeature, css: { active: $parent.selectedFeatures.indexOf($data) != -1  }">
                            <a href="#"> 
                                <i style="width:14px; height:14px; padding-right: 6px;" class="icon-ok"
                                   data-bind="css: { 'icon-white': $parent.selectedFeatures.indexOf($data) == -1 }"></i>
                                <span data-bind="text: fields.name">
                            </a>
                            </li>
                        </ul>
                    </div>
                </div>
				-->
                <div class="span12 well">
                    <div class="hide" data-bind="if: scenarioList().length == 0" style="text-align:center">
                        <p class="muted" style="margin-top: 88px; margin-bottom: 88px;" data-bind="visible: scenarioList().length === 0">
                           Create a New Scenario to evaluate.
                       </p>
                    </div>
                    <div>  <!--  data-bind="if: selectedFeatures().length > 0"> -->
						<header class="clearfix">
							<h1>Evaluate Scenarios</h1>
							<div class="btn-group pull-right">
								<button class="btn btn-mini" data-bind="click: cancelManageScenarios"> 
                                    <i class="icon-backward"></i> Back to Properties 
                                </button>
                                <button class="btn btn-mini" data-bind="click: reloadScenarios"> 
                                    <i class="icon-repeat"></i> Refresh
                                </button>
								<a href="#" class="btn btn-mini btn-success" data-bind="click: newScenarioStart">
                                    <i class="icon-plus-sign icon-white"></i> New Scenario
                                </a>
							</div>
						</header>

                        <table class="table table-condensed table-hover table-bordered">
                        <!--<tbody data-bind="foreach: selectedFeatures">-->
                        <tbody data-bind="foreach: scenarioList">
                            <tr class="scenario-row" data-bind="click: $parent.toggleFeature">
                                <td data-bind="css:{ 'highlighted-scenario': $parent.selectedFeatures.indexOf($data) !== -1 }"> 
                                    <div class="pull-right">
                                        <button href="#" id="delete-button" class="btn btn-mini" 
                                            data-bind="click: $parent.showDeleteDialog">
                                            <i class="icon-remove"></i>Delete</button>
                                        <button class="btn btn-mini" href="#" 
                                            data-bind="click: $parent.editFeature">
                                            <i class="icon-edit"></i>Edit</button>
                                    </div>

                                    <div class="pull-left" style="margin: 12px; padding:2px; border:1px #ddd solid">
                                        <i style="width:14px; height:14px;" 
                                           class="icon-ok"
                                           data-bind="css: { 'icon-white': $parent.selectedFeatures.indexOf($data) == -1 }">
                                        </i>
                                    </div>
                                    <h5> <span data-bind="text: fields.name"><span> </h5>
                                    <span data-bind="text: fields.description"></span>
                                    <p>
                                    <div class="scenario-details">
                                        <!-- <ol style="font-size:9pt; margin:12px;" class="alert"
                                              data-bind="css: { 'alert-info': fields.is_runnable && 
                                              fields.property_is_runnable && !fields.needs_rerun }"> 
                                              -->
                                        <ol style="font-size:9pt; margin:12px;" class="alert"
                                              data-bind="visible: !fields.is_runnable || 
                                              !fields.property_is_runnable || fields.needs_rerun || fields.is_running"> 
                                            <li> 
                                                Scenario is runnable? (each stand has a rx)
                                                <em data-bind="text: fields.is_runnable"></em>
                                            </li>
                                            <li> 
                                                Property is runnable? (each stand has a condition)
                                                <em data-bind="text: fields.property_is_runnable"></em>
                                            </li>
                                            <li> 
                                                Needs rerun? (stands or strata have changed)
                                                <em data-bind="text: fields.needs_rerun"></em>
                                            </li>
                                            <li> 
                                                Still running? (currently processing or sitting in the task queue)
                                                <em data-bind="text: fields.is_running"></em>
                                            </li>
                                        </ol>
                                    </div>
                                    </p>
                                </td>
                            </tr>
                        </tbody>
                        </table>

                    </div>
                </div>
              </div>
              <div class="modal" id="scenario-delete-dialog" style="display:none">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>Delete Stand</h3>
                </div>
                <div class="modal-body">
                    <div data-bind="if: activeScenario">
                    Are you sure you want to delete "<span data-bind="text: activeScenario().fields.name"></span>"?
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn" data-dismiss="modal">cancel</a>
                    <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Scenario</a>
                </div>
              </div>
            </div>

            <!-- these are all stand pages -->
            <div id="stand-html" style="display: none" data-bind="visible: showStandPanels, if: showStandPanels">
              <div class="row-fluid">
                <div data-bind="visible: showStandList">
					<p class="info text-info well well-small">
						<i class="icon-info-sign"></i> Select a stand on the map to see or edit the stand's details.
					</p>
					<div class="loading" data-bind="visible: showProgressBar">
						<h3>Loading...</h3>
					</div>
					<!-- 
					<div class="progress progress-striped active" data-bind="visible: showProgressBar">
					  <div class="bar" style="width: 100%"></div> 
					  <div class="bar" data-bind="style: { width: progressBarWidth() }"></div>
					</div>
					-->

                  <p data-bind="visible: ! standList().length"></p>
                  <div data-bind="if: standList().length > 0">
                  <div class="row-fluid">
                    <div class="well">
                        <div class="pull-right btn-group">
                            <button href="#" id="delete-button" class="btn btn-mini" 
                                data-bind="click: showDeleteDialog"><i class="icon-remove"></i> Delete</button>
                            <button class="btn btn-mini" href="#" 
                                data-bind="click: editStand">
                                <i class="icon-edit"></i> Edit</button>
                        </div>
                        <h3>Stand Details</h3>
                        <div class="stand-detail" data-bind="with: selectedFeature">
                            <p>
                                <dl class="dl-horizontal">
                                    <dt>Area</dt>
                                    <dd><span data-bind="text: acres"></span> acres</dd>
									<dt>Aspect</dt><dd><span data-bind="text: aspect"></span>&nbsp;</dd>
									<dt>Slope</dt><dd data-bind="text: slope">&nbsp;</dd>
									<dt>Elevation</dt><dd><span data-bind="text: elevation"></span> ft</dd>
                                </dl>

                                <hr>

                                <h4> Strata </h4>
                                <dl class="dl-horizontal" data-bind="with: strata">
                                    <dt>Strata UID</dt><dd><span data-bind="text: uid"></span></dd>
                                    <dt>Age</dt><dd><span data-bind="text: search_age"></span></dd>
                                    <dt>TPA</dt><dd><span data-bind="text: search_tpa"></span></dd>
                                    <dt>Stand List</dt><dd>
                                        <ul data-bind="foreach: stand_list.classes">
                                            <li data-bind="text: $data"></li>
                                        </ul>
                                    </dd>

                                </dl>

                                <h4> Nearest Neighbor IDB Plot</h4>
                                <dl class="dl-horizontal" data-bind="with: condition">
                                    <dt>Condition ID</dt><dd><span data-bind="text: cond_id"></span></dd>
                                    <dt>Age</dt><dd><span data-bind="text: age_dom"></span></dd>
                                    <dt>Forest Type</dt><dd><span data-bind="text: for_type_name"></span></dd>
                                    <dt>Forest Type (secndry)</dt><dd><span data-bind="text: for_type_secdry_name"></span></dd>
                                    <dt>Canopy Cover %</dt><dd><span data-bind="text: cancov"></span></dd>
                                    <dt>Stand height</dt><dd><span data-bind="text: stndhgt_stunits"></span></dd>
                                    <dt>Stand density index</dt><dd><span data-bind="text: sdi"></span></dd>
                                    <dt>quadratic mean diameter</dt><dd><span data-bind="text: qmda_dom_stunits"></span></dd>
                                    <dt>basal area</dt><dd><span data-bind="text: baa_ge_3_stunits"></span></dd>
                                    <dt>tph</dt><dd><span data-bind="text: tph_ge_3_stunits"></span></dd>
                                    <dt>proportion of conifer</dt><dd><span data-bind="text: bac_prop"></span></dd>
                                </dl>

                            </p>
                      </div>
                    </div>
					<div class="pull-right btn-group">
						<button class="btn tool-tip" data-toggle="tooltip" title="If you already have GIS data..."><i class="icon-upload"></i> Upload Stands</button>
						<a class="btn tool-tip" href="#" data-toggle="tooltip" title="Stand groups are ..." 
							data-bind="attr: { href: '/trees/strata/' + app.selectedPropertyUID }" >
							<i class="icon-repeat"></i> Define Stand Groups</a>
						<button class="btn btn-success" href="#" data-bind="click: addStandStart">
							<i class="icon-plus-sign icon-white"></i> Draw a New Stand</button>
					</div>
                  </div>
                  </div>
                  <div data-bind="if: standList().length, visible: standList().length > 10">
                    <div class="pagination">
                      <ul data-bind="foreach: paginationList">
                        <li data-bind="click: $parent.setListIndex, css: { 'active': $parent.listStart() === listIndex, 'disabled': displayIndex === '...' }">
                          <a href="#" data-bind="text: displayIndex, attr: { title: listIndex }"></a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div id="stands-none" class="well clearfix" data-bind="visible: ! standList().length">
                    <h3>Define New Stand Boundaries</h3>
                    <p>Then you will be asked to enter some additional information to help describe your property.</p>
                    <div class="pull-right">
                      <button href="#" class="btn" data-bind="click: cancelManageStands">Cancel</button>
                      <button href="#" class="btn btn-success" data-bind="click: addStandStart">Draw Stand</button>
                    </div>
                  </div>
                </div>
                <div data-bind="visible: showDrawPanel">
                  <h3>Draw your stand</h3>
                  <p>Starting drawing your stand. Double-click to finish.</p>
                  <div class="pull-right">
                    <button href="#" class="btn" data-bind="click: cancelAddStand">Cancel</button>
                  </div>
                </div>
              </div> <!-- no properties -->
              <div class="row-fluid" data-bind="visible: showStandFormPanel">
                <h3>Confirm Stand Boundaries</h3>
                <div id="stands-form-container" class="form-panel"></div>
                <div class="pull-right">
                  <button href="#" class="btn" data-bind="click: cancelAddStand">Cancel</button>
                  <button href="#" class="btn btn-success" data-bind="click: saveStandForm">Save Stand</button>
                </div>
              </div>

              <div class="modal" id="stand-delete-dialog" style="display:none">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>Delete Stand</h3>
                </div>
                <div class="modal-body">
                    <div data-bind="if: selectedFeature()">
                    Are you sure you want to delete "<span data-bind="text: selectedFeature().name"></span>"?
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn" data-dismiss="modal">cancel</a>
                    <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Stand</a>
                </div>
              </div>
            </div>
            <!-- end of stand pages -->
            <!-- scenario pages -->
            <div class="row-fluid hide" id="scenario-form-metacontainer">
                <div class="well">
                    <h3>Define your scenario</h3>
                    <div id="scenario-form-container">
                        <h4>Loading...</h4>
                    </div>
                </div>
            </div>
          {% endif %}
          </div>
          <div class="span7">
            <div class="outermap well">
              {% if user.is_authenticated %}
              <!-- Not sure why but non authenticated requests cause failure in geoSearch knockout binding -->
              <div id="searchbox-container" class="pull-right">
                {% include "common/geosearch.html" %}
              </div>
              {% endif %}
              <div id="map"></div>
              <div id="scenario-outputs" style="display:none">
                    <ul class="nav nav-tabs" id="myTab">
                        <li class="active"><a href="#scenario-charts-tab-content" id="scenario-charts-tab" data-toggle="tab">Charts</a></li>
                        <li>
                            <a href="#scenario-maps-tab-content" id="scenario-maps-tab" data-toggle="tab">Time-series Maps</a>
                        </li>
                        <!--
                        <li>
                            <a href="#scenario-cash-tab-content" id="scenario-cash-tab" data-toggle="tab">Cash-flow Analysis</a>
                        </li>
                        <li>
                            <a href="#scenario-market-tab-content" id="scenario-market-tab" data-toggle="tab">Market Opportunities</a>
                        </li>
                        -->
                    </ul>
                    
                    <div class="tab-content">
                        <!--
                        <div class="tab-pane fade" id="scenario-cash-tab-content">
                            <h4> Cash Flow Analysis </h4>
                            <div style="height: 200px;"><p class="muted">Coming soon...</p></div>
                        </div>

                        <div class="tab-pane fade" id="scenario-market-tab-content">
                            <h4> Market Opportunities </h4>
                            <div style="height: 200px;"><p class="muted">Coming soon...</p></div>
                        </div>
                        -->

                        <div class="tab-pane fade active in" id="scenario-charts-tab-content">
                            <div>
                                <select id="chart-metrics-select" class="selectpicker"></select>
                                <p class="muted" style="margin: 25px; font-size: 16pt;" 
                                   data-bind="visible: scenarioList().length > 0 && selectedFeatures().length === 0">
                                    Select one or more scenarios to evaluate.
                                </p>  
                                <p class="muted" style="margin: 25px; font-size: 18pt;" 
                                   data-bind="visible: scenarioList().length == 0">
                                    Loading Scenarios...
                                </p>  
                            </div>
                            <div id="chart-scenario" class="chart"></div>
                        </div>

                        <div class="tab-pane fade" id="scenario-maps-tab-content">
                            <div>
                                <div class="row-fluid">
                                    <div class="span3">
                                        <select id="timemap-metrics-select" class="selectpicker">
                                            <!-- populated by init.js -->
                                        </select>
                                    </div>
                                    <div class="span3">
                                        <div class="pull-right">
                                            <label id="year-label" for="field-year-slider">Year:</label> 
                                            <input class="input-mini slidervalue year-slider-value" 
                                                type="text" name="year-slider" id="field-year-slider" />
                                        </div>
                                    </div>
                                    <div class="span6">
                                        <div class="row-fluid">
                                            <div class="span1">
                                                <button id="timemap-backward" class="btn btn-mini"> 
                                                    <i class="icon-backward"></i>
                                                </button>
                                            </div>
                                            <div class="span1"><p class="pull-right">2020</p></div>
                                            <div class="span8" style="padding: 3px;">
                                                <div class="slider" id="slider-year-slider"></div> 
                                            </div>
                                            <div class="span1"><p class="pull-left">2120</p></div>
                                            <div class="span1">
                                                <button href="#" id="timemap-forward" class="btn btn-mini"> 
                                                    <i class="icon-forward"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 25px;">

                                <div class="timemap-container" style="position:relative;">
                                    <div class="well hide error-timemap alert alert-error" id="error-timemap1">
                                        <p> This scenario doesn't have valid modeling results... </p>
                                    </div>
                                    <div class="timemap" id="timemap1"></div>
                                    <select id="select-scenario1" class="scenario-select" data-bind="foreach: selectedFeatures">
                                        <option data-bind="value: pk, text: fields.name"></option>
                                    </select>
                                </div>
                                <div class="timemap-container" style="position:relative;">
                                    <div class="well hide error-timemap alert alert-error" id="error-timemap2">
                                        <p> This scenario doesn't have valid modeling results... </p>
                                    </div>
                                    <div class="timemap" id="timemap2"></div>
                                    <select id="select-scenario2" class="scenario-select" data-bind="foreach: selectedFeatures">
                                        <option data-bind="value: pk, text: fields.name"></option>
                                    </select>
                                    <!--
                                    <select data-bind="options: selectedFeatures, 
                                                       optionsText: 'fields.name', 
                                                       optionsValue: 'pk'"></select>
                                    -->
                                </div>
                            </div>
                        </div>
                    </div>
              </div> <!-- end scenario-outputs -->
              
            </div>
          </div>
        </div>
      </div>
      <!-- end partial -->

{% endblock content %}
{% block scripts %}
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}jqplot/jquery.jqplot.min.css" />
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}common/css/jquery-widgets.css" />
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}common/css/decisiontree.css" />
    <link class="include" rel="stylesheet" type="text/css" 
          href="{{MEDIA_URL}}support/bootstrap-select/bootstrap-select.min.css" />

    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="{{MEDIA_URL}}/jqplot/excanvas.js"></script><![endif]-->
    <script src="{{MEDIA_URL}}common/js/underscore.string.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/jquery.jqplot.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.highlighter.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.enhancedLegendRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/chart.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery.scrollTo-1.3.3-min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/decisiontree.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery-ui.min.js"></script> 
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery.ui.slider.js"></script> 
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap-select/bootstrap-select.min.js" />
    ></script> 

    {% load compressed %}
    <script type="text/javascript">

        // if console is undefined, use an empty function so console.log wont break old browsers
        if ( ! window.console ) console = { log: function(){} };

        var madrona = {
            onShow: function (callback) {
                callback();
                //madrona.formCallbacks.push(callback);
            }, 
            formCallbacks: [],
            features: {}
        };

        var app = {
            stands: {},
            scenarios: {},
            properties: {}
        };

        {% if user.is_authenticated %}
        $.get('/features/{{user.username}}/workspace-owner.json', function (data) {
            app.workspace = data;
        });
        {% else %}
        $.get('/features/workspace-public.json', function (data) {
            app.workspace = data;
        });
        {% endif %}

    </script>
    <script type="text/javascript" src="{{MEDIA_URL}}features/js/workspace.js"></script>
    <script src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script>
    <script src="{{ MEDIA_URL }}OpenLayers.js"></script>
    {% compressed_js 'application' %}

    <script src="{{ MEDIA_URL }}common/js/hash_routing.js"></script>
    <script src="{{ MEDIA_URL }}common/js/geosearch.js"></script>
    <script src="{{ MEDIA_URL }}common/js/init.js"></script>
    <script src="{{ MEDIA_URL }}common/js/breadcrumbs.js"></script>
    <script src="{{ MEDIA_URL }}common/js/timemap.js"></script>

{% endblock scripts %}
