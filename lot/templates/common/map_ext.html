{% extends 'common/base.html' %}
{% load url from future %}

{% block content %}
        <div class="row-fluid">
          <div class="span5">
              <div data-bind="visible: breadcrumbs.length > 0">
                <ul id="breadcrumbs" class="breadcrumb" data-bind="foreach: breadcrumbs">
                    <li data-bind="visible: ! $parent.isLast($data)">
                        <a data-bind="text: name, click: action"></a>
                        <span class="divider">/</span>
                    </li>
                    <li class="active" data-bind="visible: $parent.isLast($data)">
                        <span data-bind="text: name"></span>
                    </li>
                </ul>
            </div>
            <div id="home-html" class="well">
                <div style="width: 100%; text-align: center;">
                    <h3>An online tool for forest management and scenario planning</h3>
                </div>

                <div class="img-polaroid">
                    <div id="myCarousel" class="carousel slide">
                        <div class="carousel-inner" style="max-height: 440px;">
                            <div class="item active">
                                <img src="/media/img/forest_photos/garibaldi.jpg"/>
                            </div>
                            <div class="item">
                                <img src="/media/img/forest_photos/jedsmith.jpg"/>
                            </div>
                            <div class="item">
                                <img src="/media/img/forest_photos/drift_creek.jpg"/>
                            </div>
                        </div>
                    <a class="left carousel-control" href="#myCarousel" data-slide="prev">‹</a>
                    <a class="right carousel-control" href="#myCarousel" data-slide="next">›</a>
                    </div>
                </div>

                <div style="margin: 16px;">
                    <p>
                        &nbsp;&nbsp;&nbsp;&nbsp;Ecotrust is developing online software that will give all Oregon and Washington 
                        land managers forest managment scenario planning capacity. You will be able to <strong>visualize 
                            alternative management scenarios</strong> on your lands and receive immediate feedback on <strong>how  
                            decisions might pay off</strong> in terms of timber harvests and financial returns, as well as 
                        <strong>public benefits</strong> like carbon storage and ecosystem services.
                    </p>
                    
                    <p>
                    {% if not user.is_authenticated %}
                    <div class="btn-group pull-right">
                        <!-- <a class="btn btn-large" href="{% url 'registration_register' %}" id="register">Register</a> -->
                        <a class="btn btn-large" href="{% url 'account_login' %}" id="signin">Log In</a>
                    </div>
                    {% else %}
                    <a class="btn btn-large btn-success pull-right" id="manage-your-properties" href="#">Manage Your Properties</a>
                    <div class="clearfix"></div>
                    {% endif %}
                    </p>                
                </div>
            </div>

            {% if user.is_authenticated %}
            <div id="property-html" data-bind="visible: showPropertyPanels" > 
                <div class="modal" id="delete-dialog" style="display:none">
                    <div class="modal-header">
                        <a class="close" data-dismiss="modal">×</a>
                        <h3>Delete Property</h3>
                    </div>
                    <div class="modal-body">
                        <div data-bind="if: selectedProperty()">
                            Are you sure you want to delete "<span data-bind="text: selectedProperty().name"></span>"?
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="#" class="btn" data-dismiss="modal">cancel</a>
                        <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Property</a>
                    </div>
                </div>
                <div class="well" style="display:none;" data-bind="visible: propertyList().length === 0"> 
                    <!-- data-bind="if: showNoPropertiesHelp"> -->
                    <h2>Create Properties</h2>
                    <p><em>You currently have no properties under management.</em></p>
                    <div id="properties-none">
                        <p>When your property is in view on the map, click the button below to draw the boundaries of your first property.</p>
                        <div class="pull-right">
                            <button href="#" class="btn" data-bind="click: startUpload, disable: preventUpdates">
                                <i class="icon-upload"></i> Upload GIS Data</button>
                            <button href="#" class="btn btn-success" 
                                data-bind="click: startAddDrawing, disable: preventUpdates">Draw Property Boundary</button>
                        </div>
                    </div> <!-- no properties -->
                </div><!-- end of no properties -->
                <div class="row-fluid">
                    <div class="span4">
                        <div id="properties-list" style="display: none;" class="well"
                            data-bind="visible: propertyList().length > 0">
                            <p>
                                <div class="btn-group">
                                    <a class="btn" href="#">Property List</a>
                                    <a class="btn dropdown-toggle" data-toggle="dropdown" href="#"><span class="caret"></span></a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a href="#" data-bind="click: startAddDrawing, disable: preventUpdates">
                                                <i class="icon-plus-sign"></i> Draw New Property
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#" data-bind="click: startUpload, disable: preventUpdates">
                                                <i class="icon-upload"></i> Upload GIS Data
                                            </a>
                                        </li>
                                        <li class="divider"></li>
                                        <li>
                                            <a href="#" data-bind="click: zoomToExtent, disable: preventUpdates">
                                                <i class="icon-resize-full"></i> Show All
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </p>


                            <div style="display:none"  data-bind="visible: propertyList().length">
                                <table class="table table-condensed table-bordered table-hover">
                                <tbody data-bind="foreach: propertyList">
                                    <tr data-bind="click: $parent.selectProperty, css: { active: $data === $parent.selectedProperty() }">
                                    <td><a data-bind="text: name"></a></td>
                                    </tr>
                                </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div style="display: none;" class="span8 well property-details" 
                        data-bind="if: showDetailPanel, visible: showDetailPanel">
                        <div class="pull-right btn-group">
                          <button href="#" id="delete-button" class="btn btn-mini" 
                              data-bind="click: showDeleteDialog"><i class="icon-remove"></i> Delete </button>
                          <button class="btn btn-mini" href="#" 
                              data-bind="click: showEditForm, disable: preventUpdates">
                              <i class="icon-edit"></i> Edit </button>
                        </div>
                        <h3>Property Details</h3>

                        <dl class="dl-horizontal" data-bind="if: selectedProperty()">
                            <dt>Property Name</dt>
                            <dd><em><span data-bind="text: selectedProperty().name"><span></em></dd>
                            <dt>Area</dt>
                            <dd><span data-bind="text: selectedProperty().acres()"></span> acres</dd>
                            <dt>Location</dt>
                            <dd><span data-bind="text: selectedProperty().location"></span></dd>
                            <dt>Number of Stands</dt>
                            <dd>
                                <span data-bind="text: selectedProperty().stand_summary.with_strata"></span> 
                                of <span data-bind="text: selectedProperty().stand_summary.total"></span> with strata 
                            </dd>
                            <dd>
                                <span data-bind="text: selectedProperty().stand_summary.with_condition"></span> 
                                of <span data-bind="text: selectedProperty().stand_summary.total"></span> with condition 
                            </dd>
                            <dd>
                                <span data-bind="text: selectedProperty().stand_summary.with_terrain"></span> 
                                of <span data-bind="text: selectedProperty().stand_summary.total"></span> with terrain 
                            </dd>
                        </dl>

                        <div class="row-fluid">
                            <div class="span4">
                                <button class="btn pull-right btn-success" href="#" 
                                    data-bind="click: manageStands">
                                <i class="icon-adjust icon-white"></i> Define Stand Boundaries</button>
                            </div>
                            <div class="span4">
                                <a class="btn pull-right btn-success"  
                                    data-bind="attr: { href: '/trees/strata/' + selectedProperty().uid() }">
                                <i class="icon-repeat icon-white"></i> Define Stand Groups</a>
                            </div>
                            <div class="span4">
                                <button class="btn pull-right btn-success" href="#" data-bind="click: manageScenarios, 
                                  css: {disabled: selectedProperty().stand_summary.with_condition() < selectedProperty().stand_summary.total()}">
                                <i class="icon-repeat icon-white"></i> Evalutate Future Scenarios</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row-fluid"><!-- panels -->
                  <div>
                    <div style="display:none" data-bind="visible: showUploadPanel">
                      <h2>Upload stands</h2>
                      <p> File upload </p>
                      <ul> 
                          <li> A .zip file containing an ESRI Shapefile </li>
                          <li> Projected to Web Mercator </li>
                          <li> Contains polygons of all stands </li>
                          <li> Must contain an string attribute field called <em>name</em> or <em>STAND_ID</em> </li>
                      </ul>
                      <div class="well">
                      <form id="uploadForm" action="{% url 'trees-upload_stands' %}" method="post" enctype="multipart/form-data"> 
                            <input type="hidden" name="MAX_FILE_SIZE" value="100000">
                            <p> 
                                <label for="upload-propertyname">
                                    <span id="upload-propertyname-required" class="label label-important"
                                        style="display:none;"> 
                                        Required 
                                        <i class="icon-exclamation-sign icon-white"></i> 
                                    </span>
                                    &nbsp; New Property Name
                                </label>
                                <input type="text" id="upload-propertyname" name="new_property_name" size="10"/>
                            </p>
                            <p> 
                                <span id="upload-file-required" class="label label-important"
                                    style="display:none;"> 
                                    Required 
                                    <i class="icon-exclamation-sign icon-white"></i> 
                                </span>
                                <input type="file" id="upload-file" name="ogrfile" size="10"/> 
                            </p>
                            <div class="pull-right">
                                <a href="#" class="btn" data-bind="click: cancelUpload">Cancel</a>
                                <input id="uploadbutton" type="submit" class="btn btn-success" value="Upload"/>
                            </div>
                      </form>
                      <div id="uploadProgress" style="display: none; width:80%;" class="progress progress-striped active">
                        <div class="bar" style="width: 0%;"></div>
                      </div>
                      <div id="uploadResponse" style="width: 80%; font-size: 125%;"></div>
                      </div>
                    </div>
                    <div style="display:none" data-bind="if: showDrawHelpPanel, visible: showDrawHelpPanel">
                      <h2>Draw Property Boundary</h2>
                      <p> Double-click to complete polygon. </p>
                      <div class="pull-right">
                        <a href="#" class="btn" data-bind="click: cancelEdit">Cancel</a>
                      </div>
                    </div>

                    <div class="form-panel" style="display: none" data-bind="if: showEditPanel, visible: showEditPanel">
                      <h2>Edit Property</h2>
                      <div id="edit-panel"></div>
                      <div class="pull-right" id="edit-panel-buttons">
                        <a href="#" class="btn" data-bind="click: cancelEdit">Cancel</a>
                        <a href="#" class="btn btn-success" data-bind="click: updateFeature">Save changes</a>
                      </div>
                    </div>
                    <div class="form-panel" style="display:none" data-bind="if: showCreatePanel, visible: showCreatePanel">
                      <h2>Create Property</h2>
                      <div id="create-panel"></div>
                      <div class="pull-right" id="create-panel-buttons">
                        <a href="#" class="btn" data-bind="click: cancelEdit">Cancel</a>
                        <a href="#" class="btn btn-success" data-bind="click: addFeature">Create</a>
                      </div>
                    </div>
                  </div>
              </div>
            </div>
            <!-- end of property pages -->

            <div id="scenario-html" style="display: none" data-bind="visible: showScenarioPanels, if: showScenarioPanels">
              <div class="row-fluid" data-bind="visible: showScenarioList">
                <div class="span4 well">
                    <h3>Scenario List</h3>
                    <p>
                        <div class="btn-group">
                            <a href="#" class="btn" data-bind="click: newScenarioStart"><i class="icon-plus-sign"></i> New Scenario</a>
                        </div>
                    </p>
                    <div>
                        <ul class="nav nav-tabs nav-stacked" data-bind="foreach: scenarioList">
                            <li data-bind="click: $parent.toggleFeature, css: { active: $parent.selectedFeatures.indexOf($data) != -1  }">
                            <a href="#"> 
                                <i style="width:14px; height:14px; padding-right: 6px;" class="icon-ok"
                                   data-bind="css: { 'icon-white': $parent.selectedFeatures.indexOf($data) == -1 }"></i>
                                <span data-bind="text: fields.name">
                            </a>
                            </li>
                        </ul>
                    </div>
                    <button class="btn btn-mini" data-bind="click: cancelManageScenarios">
                        <i class="icon-backward"></i> Back to Properties 
                    </button>
                </div>
                <div class="span8 well">
                    <div data-bind="if: selectedFeatures().length == 0" style="text-align:center">
                        <p class="muted" style="margin-top: 88px; margin-bottom: 88px;" data-bind="visible: scenarioList().length === 0">
                           Create a New Scenario to evaluate.</p> 
                        <p class="muted" style="margin-top: 88px; margin-bottom: 88px;" data-bind="visible: scenarioList().length > 0">
                           Select one or more scenarios to evaluate.</p> 
                    </div>
                    <div data-bind="if: selectedFeatures().length > 0">
                        <h3>Details for Selected Scenarios</h3>
                        <table class="table table-condensed table-striped table-hover table-bordered">
                        <tbody data-bind="foreach: selectedFeatures">
                            <tr class="scenario-row" rel="popover">
                                <td> 
                                    <h5> <span data-bind="text: fields.name"><span> </h5>
                                    <span data-bind="text: fields.description"></span>
                                    <div class="pull-right">
                                        <button href="#" id="delete-button" class="btn btn-mini" 
                                            data-bind="click: $parent.showDeleteDialog">
                                            <i class="icon-remove"></i></button>
                                        <button class="btn btn-mini" href="#" 
                                            data-bind="click: $parent.editFeature">
                                            <i class="icon-edit"></i></button>
                                        <!--
                                        <button class="btn btn-mini" href="#" 
                                            data-bind="click: ">
                                            <i class="icon-info-sign"></i></button>
                                        -->
                                    </div>
                                    <p>
                                    <div class="scenario-details hide">
                                        <div>
                                            <dl class="dl-horizontal">
                                                <dt>Target Carbon?</dt>
                                                <dd data-bind="text: fields.input_target_carbon"></dd>
                                                <dt>Target Annual Cut</dt>
                                                <dd data-bind="text: fields.input_target_boardfeet"></dd>
                                                <dt>Target Site Diversity</dt>
                                                <dd data-bind="text: fields.input_site_diversity"></dd>
                                                <dt>Target Mature Age Class</dt>
                                                <dd data-bind="text: fields.input_age_class"></dd>
                                            </dl>
                                        </div>
                                        <!--
                                        <div>
                                            <img src="/media/img/temp_rx.jpg" size="width:300px;" class="img-polaroid"/>
                                        </div>
                                        -->
                                    </div>
                                    </p>
                                </td>
                                <!--
                                <td data-bind="text: fields.name" class="hide scenario-name"></td>
                                <td class="hide scenario-details">
                                -->
                                    <!--
                                    <dd data-bind="text: fields.input_rxs"></dd> 
                                    <span data-bind="text: chartColors[0]"></span>
                                    <span data-bind="text: $index"></span> 
                                    <span data-bind="text: chartColors[$index]"></span>
                                    <span><div style="height: 20px; width: 20px; border: 1px grey solid;" 
                                            data-bind="style: {backgroundColor: chartColors[$index]}"></div></span>
                                    <span data-bind="text: fields.output_scheduler_results"></span> 
                                    -->
                            </tr>
                        </tbody>
                        </table>

                    </div>
                </div>
              </div>
              <div class="modal" id="scenario-delete-dialog" style="display:none">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>Delete Stand</h3>
                </div>
                <div class="modal-body">
                    <div data-bind="if: activeScenario">
                    Are you sure you want to delete "<span data-bind="text: activeScenario().fields.name"></span>"?
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn" data-dismiss="modal">cancel</a>
                    <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Scenario</a>
                </div>
              </div>
            </div>

            <!-- these are all stand pages -->
            <div id="stand-html" style="display: none" data-bind="visible: showStandPanels, if: showStandPanels">
              <div class="row-fluid">
                <div data-bind="visible: showStandList">
                  <div class="progress progress-striped active" data-bind="visible: showProgressBar">
                    <div class="bar" data-bind="style: { width: progressBarWidth() }"></div>
                  </div>
                  <p data-bind="visible: ! standList().length"></p>
                  <div data-bind="if: standList().length > 0">
                  <div class="row-fluid">
                    <div class="span5 well">
                        <!--<div class="btn-group">-->
                            <button class="btn" href="#" data-bind="click: addStandStart"><i class="icon-plus-sign"></i> Draw Stand</button>
                            <button class="btn" href="#"><i class="icon-upload"></i> Upload Stands</button>
                        <!--</div>-->
                            <div style="margin-top:22px; margin-bottom: 20px;">
                                <ul class="unstyled" data-bind="foreach: standListPaginated">
                                    <li data-bind="click: $parent.selectFeature, css: { active: $data === $parent.selectedFeature() }">
                                        <span>
                                            <a href="#" data-bind="text: name"></a>
                                        </span>
                                    </li>
                                </ul>
                            </div>
                            <p>
                                <button class="btn btn-mini" data-bind="click: cancelManageStands">
                                    <i class="icon-backward"></i> Back to Properties 
                                </button>
                            </p>
                    </div>
                    <div class="span7 well"  data-bind="if: selectedFeature">
                        <div class="pull-right btn-group">
                            <button href="#" id="delete-button" class="btn btn-mini" 
                                data-bind="click: showDeleteDialog"><i class="icon-remove"></i> Delete</button>
                            <button class="btn btn-mini" href="#" 
                                data-bind="click: editStand">
                                <i class="icon-edit"></i> Edit</button>
                        </div>
                        <h3>Stand Details</h3>
                        <div class="stand-detail" data-bind="with: selectedFeature">
                            <p>
                                <dl class="dl-horizontal">
                                    <dt>Stand ID</dt>
                                    <dd><span data-bind="text: name"></span></dd>
                                    <dt>Area</dt>
                                    <dd><span data-bind="text: acres"></span> acres</dd>
                                </dl>

                                <!--<h4>Terrain</h4>-->
                                <dl class="dl-horizontal">
                                    <dt>Aspect</dt><dd data-bind="text: aspect"></dd>
                                    <dt>Slope</dt><dd data-bind="text: slope"></dd>
                                    <dt>Elevation</dt><dd><span data-bind="text: elevation"></span> ft</dd>
                                </dl>

                                <dl class="dl-horizontal">
                                    <dt>Condition ID</dt><dd><span data-bind="text: cond_id"></span></dd>
                                    <dt>Strata</dt><dd><span data-bind="text: strata_uid"></span></dd>
                                </dl>

                            </p>
                      </div>
                    </div>
                  </div>
                  </div>
                  <div data-bind="if: standList().length, visible: standList().length > 10">
                    <div class="pagination">
                      <ul data-bind="foreach: paginationList">
                        <li data-bind="click: $parent.setListIndex, css: { 'active': $parent.listStart() === listIndex, 'disabled': displayIndex === '...' }">
                          <a href="#" data-bind="text: displayIndex, attr: { title: listIndex }"></a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div id="stands-none" class="well" data-bind="visible: ! standList().length">
                    <h3>Define New Stand Boundaries</h3>
                    <p>Then you will be asked to enter some additional information to help describe your property.</p>
                    <div class="pull-right">
                      <button href="#" class="btn" data-bind="click: cancelManageStands">Cancel</button>
                      <button href="#" class="btn btn-success" data-bind="click: addStandStart">Draw Stand</button>
                    </div>
                  </div>
                </div>
                <div data-bind="visible: showDrawPanel">
                  <h3>Draw your stand</h3>
                  <p>Starting drawing your stand. Double-click to finish.</p>
                  <div class="pull-right">
                    <button href="#" class="btn" data-bind="click: cancelAddStand">Cancel</button>
                  </div>
                </div>
              </div> <!-- no properties -->
              <div class="row-fluid" data-bind="visible: showStandFormPanel">
                <h3>Confirm Stand Boundaries</h3>
                <div id="stands-form-container" class="form-panel"></div>
                <div class="pull-right">
                  <button href="#" class="btn" data-bind="click: cancelAddStand">Cancel</button>
                  <button href="#" class="btn btn-success" data-bind="click: saveStandForm">Save Stand</button>
                </div>
              </div>

              <div class="modal" id="stand-delete-dialog" style="display:none">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>Delete Stand</h3>
                </div>
                <div class="modal-body">
                    <div data-bind="if: selectedFeature()">
                    Are you sure you want to delete "<span data-bind="text: selectedFeature().name"></span>"?
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn" data-dismiss="modal">cancel</a>
                    <a href="#" class="btn btn-danger" data-bind="click: deleteFeature">Delete Stand</a>
                </div>
              </div>
            </div>
            <!-- end of stand pages -->
            <!-- scenario pages -->
            <div class="row-fluid hide" id="scenario-form-metacontainer">
                <div class="well">
                    <h3>Define your scenario</h3>
                    <div id="scenario-form-container"></div>
                </div>
            </div>
          {% endif %}
          </div>
          <div class="span7">
            <div class="outermap well">
              {% if user.is_authenticated %}
              <!-- Not sure why but non authenticated requests cause failure in geoSearch knockout binding -->
              <div id="searchbox-container" class="pull-right">
                {% include "common/geosearch.html" %}
              </div>
              {% endif %}
              <div id="map"></div>
              <div id="scenario-outputs" style="display:none">
                    <ul class="nav nav-tabs" id="myTab">
                        <li class="active"><a href="#scenario-charts-tab-content" id="scenario-charts-tab" data-toggle="tab">Charts</a></li>
                        <li>
                            <a href="#scenario-maps-tab-content" id="scenario-maps-tab" data-toggle="tab">Time-series Maps</a>
                        </li>
                        <li>
                            <a href="#scenario-cash-tab-content" id="scenario-cash-tab" data-toggle="tab">Cash-flow Analysis</a>
                        </li>
                        <li>
                            <a href="#scenario-market-tab-content" id="scenario-market-tab" data-toggle="tab">Market Opportunities</a>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <div class="tab-pane fade" id="scenario-cash-tab-content">
                            <h4> Cash Flow Analysis </h4>
                            <div style="height: 200px;"><p class="muted">Coming soon...</p></div>
                        </div>

                        <div class="tab-pane fade" id="scenario-market-tab-content">
                            <h4> Market Opportunities </h4>
                            <div style="height: 200px;"><p class="muted">Coming soon...</p></div>
                        </div>

                        <div class="tab-pane fade active in" id="scenario-charts-tab-content">
                            <div id="chart-carbon" class="chart"></div>
                            <div id="chart-timber" class="chart"></div>
                        </div>

                        <div class="tab-pane fade" id="scenario-maps-tab-content">
                            <div>
                                <div class="row-fluid">
                                    <div class="span3">
                                        <select id="timemap-type">
                                            <option>Standing Timber</option>
                                            <option>Age Class</option>
                                            <option>Carbon</option>
                                            <option>Harvest Activity</option>
                                            <option>Cut Volume</option>
                                        </select>
                                    </div>
                                    <div class="span3">
                                        <div class="pull-right">
                                            <label id="year-label" for="field-year-slider">Year:</label> 
                                            <input class="input-mini slidervalue year-slider-value" 
                                                type="text" name="year-slider" id="field-year-slider" />
                                        </div>
                                    </div>
                                    <div class="span6">
                                        <div class="row-fluid">
                                            <div class="span2"><p class="pull-right">2020</p></div>
                                            <div class="span8" style="padding: 3px;">
                                                <div class="slider" id="slider-year-slider"></div> 
                                            </div>
                                            <div class="span2"><p class="pull-left">2120</p></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <div class="timemap-container">
                                    <div class="timemap" id="timemap1"></div>
                                    <select id="scenario1" class="scenario-select">
                                        <option>Scenario 1</option>
                                    </select>
                                </div>
                                <div class="timemap-container">
                                    <div class="timemap" id="timemap2"></div>
                                    <select id="scenario2" class="scenario-select">
                                        <option>Scenario 2</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
              </div> <!-- end scenario-outputs -->
              
            </div>
          </div>
        </div>
      </div>
      <!-- end partial -->

{% endblock content %}
{% block scripts %}
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}jqplot/jquery.jqplot.min.css" />
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}common/css/jquery-widgets.css" />
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}common/css/decisiontree.css" />

    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="{{MEDIA_URL}}/jqplot/excanvas.js"></script><![endif]-->
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/jquery.jqplot.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.highlighter.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.enhancedLegendRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/chart.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery.scrollTo-1.3.3-min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/decisiontree.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery-ui.min.js"></script> 
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery.ui.slider.js"></script> 

    {% load compressed %}
    <script type="text/javascript">
        var madrona = {
            onShow: function (callback) {
                callback();
                //madrona.formCallbacks.push(callback);
            }, 
            formCallbacks: [],
            features: {}
        };

        var app = {
            stands: {},
            scenarios: {},
            properties: {}
        };

        {% if user.is_authenticated %}
        $.get('/features/{{user.username}}/workspace-owner.json', function (data) {
            app.workspace = data;
        });
        {% else %}
        $.get('/features/workspace-public.json', function (data) {
            app.workspace = data;
        });
        {% endif %}

    </script>
    <script type="text/javascript" src="{{MEDIA_URL}}features/js/workspace.js"></script>
    <script src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script>
    <script src="{{ MEDIA_URL }}OpenLayers.js"></script>
    {% compressed_js 'application' %}

    <script src="{{ MEDIA_URL }}common/js/hash_routing.js"></script>
    <script src="{{ MEDIA_URL }}common/js/geosearch.js"></script>
    <script src="{{ MEDIA_URL }}common/js/init.js"></script>
    <script src="{{ MEDIA_URL }}common/js/breadcrumbs.js"></script>
    <script src="{{ MEDIA_URL }}common/js/timemap.js"></script>

{% endblock scripts %}
