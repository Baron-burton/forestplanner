{% extends 'common/base.html' %}
{% load url from future %}

{% block content %}
        <div class="row-fluid">
          <div class="span5">
              <div data-bind="visible: breadcrumbs.length > 0">
                <ul id="breadcrumbs" class="breadcrumb" data-bind="foreach: breadcrumbs">
                    <li data-bind="visible: ! $parent.isLast($data)">
                        <a data-bind="text: name, click: action"></a>
                        <span class="divider">/</span>
                    </li>
                    <li class="active" data-bind="visible: $parent.isLast($data)">
                        <span data-bind="text: name"></span>
                    </li>
                </ul>
            </div>
            <div class="well" style="display:none" data-bind="visible: $root">
                <h1>Manage Stand Groups</h1>

                <!-- strata list -->
                <div data-bind="visible: strata().length && ! newStratum()">
                    You have stand groups.
                </div>

                <!-- property has no strata -->
                <div data-bind="visible: !strata().length && ! newStratum()">
                    You have no stand groups.
                </div>

                <!-- creating a new stratum -->
                <div data-bind="if: newStratum()">
                    <h2>Create a New Stand Group</h2>
                    <div data-bind="with: newStratum">
                        


                            <div id="myCarousel" class="carousel slide">
                                <div class="carousel-inner">
                                    <div class="item active">
                                        <h3>Stand Group Name</h3>
                                        <input type="text" class="span12" placeholder="Stand Group Name" autofocus data-bind="value: name, valueUpdate: 'keyup'"/>
                                        <div class="row-fluid">
                                            <div class="span6">
                                                <h3>Trees Per Acre</h3>
                                                <input type="text" class="span12" data-bind="value: tpa, valueUpdate: 'keyup'">
                                            </div>
                                            <div class="span6">
                                                <h3>Stand Age</h3>
                                                <input type="text" class="span12" data-bind="value: age, valueUpdate: 'keyup'">
                                            </div>
                                        </div>
                                        <div class="row-fluid">
                                            <div class="btn-group pull-right">
                                                <!--<button class="btn btn-large"><i class="icon-white icon-plus"></i> Cancel</button>-->
                                                <button class="btn btn-large btn-success" data-bind="click: next, enable: name() && tpa() && age()">Next <i class="icon-white icon-arrow-right"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="item">
                                        <h3>Select a Species</h3>
                                        <select name="species" class="span8" data-bind="options: treeSpecies, optionsValue: 'name', optionsText: 'name', value: newSpecies, select2: { placeholder: 'Select a species'}" class="span12" style="width: 95%"></select>
                                        <div class="row-fluid">
                                            <div class="span6">
                                                <h3>Select a Size Class</h3>
                                                <label class="radio">
                                                  <input type="radio" value='1"-5"' name="size-class" data-bind="checked: newSizeClass">
                                                  1"-5"
                                                </label>
                                                <label class="radio">
                                                  <input type="radio" value='5"-10"' name="size-class" data-bind="checked: newSizeClass">
                                                  5"-10"
                                                </label>
                                                <label class="radio">
                                                  <input type="radio" value='10"-15"' name="size-class" data-bind="checked: newSizeClass">
                                                  10"-15"
                                                </label>
                                            </div>
                                            <div class="span6">
                                                <h3>Percentage of Stand</h3>
                                                <input name="percentage" data-bind="value: newPercentage, valueUpdate: 'keyup'"/>
                                            </div>
                                        </div>
                                        <div class="row-fluid">
                                            <div class="btn-group pull-right">
                                               <!--<button class="btn btn-large"><i class="icon-white icon-plus"></i> Cancel</button>-->
                                               <button class="btn btn-large" data-bind="click: prev"><i class="icon-white icon-arrow-left"></i> Back</button>
                                               <button class="btn btn-large btn-success" data-bind="click: addSpecies, enable: newSpecies() && newSizeClass() && newPercentage()"><i class="icon-white icon-plus"></i> Add Species</button>
                                            </div>
                                        </div>         
                                    </div>
                                </div>
                                
                            </div>

                            
                        
                    </div>
                </div>
            </div>
          </div>
          <div class="span7">
            <div class="well">
                <h1 data-bind="visible: !newStratum().speciesList().length">Species haven't been defined, yet.</h1>
                <table class="table table-striped table-bordered" data-bind="visible: newStratum().speciesList().length">
                    <thead>
                        <tr><th>Species</th><th>Size Class</th><th>Percentage</th></tr>
                    </thead>
                    <tbody data-bind="foreach: newStratum().speciesList">
                        <tr><td data-bind="text: species"></td><td data-bind="text: sizeClass"></td><td data-bind="text: percentage"></td></tr>
                    </tbody>
                    
                </table>
            </div>
          </div>
        </div>
        
      <!-- end partial -->

{% endblock content %}
{% block scripts %}
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/jquery.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/json2.js"></script> <!-- for the benefit of older IEs -->
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery.form.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/knockout-2.1.0.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/knockout.mapping-latest.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/knockout-custom-bindings.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/select2.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/bootstrap-tab.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/bootstrap-tooltip.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/bootstrap-carousel.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/bootstrap-button.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/bootstrap-popover.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/bootstrap-modal.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/bootstrap-dropdown.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}support/bootstrap/js/bootstrap-transition.js"></script>
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}jqplot/jquery.jqplot.min.css" />
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}common/css/jquery-widgets.css" />
    <link class="include" rel="stylesheet" type="text/css" href="{{MEDIA_URL}}support/select2.css" />

    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="{{MEDIA_URL}}/jqplot/excanvas.js"></script><![endif]-->
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/jquery.jqplot.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script class="include" type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.dateAxisRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.highlighter.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}jqplot/plugins/jqplot.enhancedLegendRenderer.min.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/chart.js"></script>
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery-ui.min.js"></script> 
    <script type="text/javascript" src="{{MEDIA_URL}}common/js/jquery.ui.slider.js"></script> 

    {% load compressed %}
    <script type="text/javascript">
        var madrona = {
            onShow: function (callback) {
                callback();
                //madrona.formCallbacks.push(callback);
            }, 
            formCallbacks: [],
            features: {}
        };

        var app = {
            stands: {},
            scenarios: {},
            properties: {}
        };

        {% if user.is_authenticated %}
        $.get('/features/{{user.username}}/workspace-owner.json', function (data) {
            app.workspace = data;
        });
        {% else %}
        $.get('/features/workspace-public.json', function (data) {
            app.workspace = data;
        });
        {% endif %}

        var treeSpecies = [
            {name: ""},
            {name: "Doug-fir"},
            {name: "Big Leaf Maple"}
        ];

        function speciesViewModel (options) {
            var self = this;

            self.species = options.species;
            self.sizeClass = options.sizeClass;
            self.percentage = options.percentage;
        };

        
        function stratumViewModel () {
            var self = this;

            self.name = ko.observable();
            self.tpa = ko.observable();
            self.age = ko.observable();

            self.newSpecies = ko.observable();
            self.newSizeClass = ko.observable();
            self.newPercentage = ko.observable();
            
            self.speciesList = ko.observableArray();

            self.addSpecies = function () {
                var self = this;
                if (self.newSpecies() && self.newSizeClass() && self.newPercentage()) {
                    self.speciesList.push(new speciesViewModel({
                        species: self.newSpecies(),
                        sizeClass: self.newSizeClass(),
                        percentage: self.newPercentage()
                    }));

                    self.newSpecies("");
                    self.newSizeClass(null);
                    self.newPercentage(null);    
                } 

            }

            self.next = function () {
                var self = this;
                $('#myCarousel').carousel('next')

            };

            self.prev = function () {
                var self = this;
                $('#myCarousel').carousel('prev')

            }

        };

        function strataViewModel () {
          var self = this;

          self.strata = ko.observableArray();

          // either false, or holds a stratumViewModel
          //self.newStratum = ko.observable(false);
          self.newStratum = ko.observable(new stratumViewModel());

          self.treeSpecies = treeSpecies;

        };
        /// to go into strata.js
        app.strata = {
            viewModel: new strataViewModel()
        }




        $(document).ready(function () {
            ko.applyBindings(app.strata.viewModel);

        });

    </script>
    <script type="text/javascript" src="{{MEDIA_URL}}features/js/workspace.js"></script>
    <script src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script>
    <script src="{{ MEDIA_URL }}OpenLayers.js"></script>
    {% compressed_js 'application' %}

    <script src="{{ MEDIA_URL }}common/js/hash_routing.js"></script>
    
    <script src="{{ MEDIA_URL }}common/js/strata.js"></script>
    <!--
    <script src="{{ MEDIA_URL }}common/js/geosearch.js"></script>
    <script src="{{ MEDIA_URL }}common/js/init.js"></script>
    <script src="{{ MEDIA_URL }}common/js/breadcrumbs.js"></script>
    <script src="{{ MEDIA_URL }}common/js/timemap.js"></script>
    -->
{% endblock scripts %}
