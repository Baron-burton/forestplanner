{% block panel %}
<style>

.tab-content {
    background-color: white;
    padding: 12px;
}
.btn-controls {
    padding: 5px;
}
.content {
    line-height: 1;
}
.btn-group {
    margin: 5px;

}
</style>

{% if form.non_field_errors %}
<div class="alert alert-error"> 
    <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
    {{form.non_field_errors}}
</div>
{% endif %}

<form class="form-horizontal" id="scenario-form" method="POST">

    <ul class="nav nav-tabs" id="myTab">
        <li class="active">
            <a href="#scenario-edit-spatial-content" id="scenario-edit-spatial-tab" data-toggle="tab">Step 1<br> Spatial Contraints</a>
        </li>
        <li>
            <a href="#scenario-edit-rx-content" id="scenario-edit-rx-tab" data-toggle="tab">Step 2<br> Silvicultural Prescriptions</a>
        </li>
        <li>
            <a href="#scenario-review-content" id="scenario-review-tab" data-toggle="tab">Step 3<br> Review</a>
        </li>
    </ul>
    
    <div class="tab-content">

        <div class="tab-pane active" id="scenario-edit-spatial-content">

            <div class="alert alert-info">
                Use <strong>spatial constraints</strong> to visualize management restrictions. 
                <br><br> 
                For example, knowing where streams and conservation
                easements exist can help you decide on appropriate management activities for 
                a given stand. 
                <br><br> 
                Note: These spatial constraint maps are <em>not</em> legal boundaries and are presented
                for reference only.
            </div>

            <div class="control-group" style="margin-left:40px;">
                <div id="constraint-layers">
                    <label class="checkbox" style="vertical-align: baseline;">
                    <input id="SpatialConstraints_input_Streams" name="Streams" type="checkbox" 
                    value="Streams" class="constraint-input">Streams</label>

                    <label class="checkbox" style="vertical-align: baseline;">
                    <input id="SpatialConstraints_input_Critical Habitat" name="Critical Habitat" type="checkbox" 
                    value="Critical Habitat" class="constraint-input">Critical Habitat</label>

                    <label class="checkbox" style="vertical-align: baseline;">
                    <input id="SpatialConstraints_input_Protected Areas" name="Protected Areas" type="checkbox" 
                    value="Protected Areas" class="constraint-input">Protected Areas</label>

                    <label class="checkbox" style="vertical-align: baseline;">
                    <input id="SpatialConstraints_input_Wetlands" name="Wetlands" type="checkbox" 
                    value="Wetlands" class="constraint-input">Wetlands</label>

                    <label class="checkbox" style="vertical-align: baseline;">
                    <input id="SpatialConstraints_input_Critical Stream Habitat" name="Critical Stream Habitat" type="checkbox" 
                    value="Critical Stream Habitat" class="constraint-input">Critical Stream Habitat</label>

                    <label class="checkbox" style="vertical-align: baseline;">
                    <input id="SpatialConstraints_input_Conservation Easements" name="Conservation Easements" type="checkbox" 
                    value="Conservation Easements" class="constraint-input">Conservation Easements</label>

                    <label class="checkbox" style="vertical-align: baseline;">
                    <input id="SpatialConstraints_input_Soil Survey" name="Soil Survey" type="checkbox" 
                    value="Soil Survey" class="constraint-input">Soil Survey</label>
                </div>
            </div>
        </div>

        <script>
            $("input.constraint-input").change(function() {
                //$("div.dataLayersDiv > input[name='" + this.name + "']").toggle();
                var layers = map.getLayersByName(this.name);
                if (layers.length) { 
                    var layer = layers[0];
                    layer.setVisibility($(this).is(':checked'));
                } else {
                    console.log('Checkbox has no OL layer by this name (check this.name).', this);
                }
            });
        </script>

        <div class="tab-pane" id="scenario-edit-rx-content">
            <div data-bind="visible: ! newRx() && selectedRx(), with: selectedRx">
                <form>
                  <fieldset>
                    <legend data-bind="visible: ! myrx_id">New Prescription</legend>
                    <legend data-bind="visible: myrx_id">Update <span data-bind="text: name"></span></legend>
                    <p data-bind="visible: $parent.decisionOutput">
                        <ul data-bind="foreach: $parent.decisionOutput">
                            <li>
                                <span data-bind="text: $data"></span>
                            </li>
                        </ul>
                    </p>
                    <br data-bind="visible: ! $parent.decisionOutput()"/>
                    <div class="control-group">
                      <label class="control-label">Name</label>
                      <div class="controls">
                        <input type="text" class="input-xlarge" data-bind="value: name">
                        <!--<p class="help-block">Supporting help text</p>-->
                      </div>
                    </div>
                    <div class="control-group">
                      <label class="control-label">Description</label>
                      <div class="controls">
                        <input type="text" class="input-xlarge" data-bind="value: description">
                        <!--<p class="help-block">Supporting help text</p>-->
                      </div>
                    </div>
                    <div class="control-group" data-bind="visible: myrx_id">
                      <label class="control-label">Update Management Style</label>
                      <div class="controls">
                        <button class="btn btn-block" data-bind="click: $parent.updateManagementStyle">Update</button>
                        <!--<p class="help-block">Supporting help text</p>-->
                      </div>
                    </div>
                    <div>
                        <a class="btn" data-bind="click: $parent.cancel">cancel</a>
                        <button class="btn" data-bind="click: $parent.saveRx">save</button>
                    </div>
                  </fieldset>
                </form>
                
            </div>
            <div data-bind="visible: ! (newRx() || selectedRx())">
                <table class="table table-condensed table-bordered">
                    <tbody data-bind="foreach: prescriptionList">
                        <tr class="scenario-row" rel="popover" data-bind="style: { 'background': color }, event: { mouseleave: function () { confirmDelete(false) } }">
                            <td> 
                                <h5><span data-bind="text: name">RX Name</span></h5>
                                <span data-bind="text: description">RX Description</span>
                                <div class="pull-right btn-group" data-bind="visible: confirmDelete">
                                  <button class="btn" data-bind="click: function () { confirmDelete(false) }">cancel</button>
                                  <button class="btn" data-bind="click: $parent.deleteRx">ok</button>
                                </div>
                                <div class="pull-right btn-group" data-bind="visible: ! confirmDelete()">
                                    <button class="btn" data-bind="enable: editable, click: function () { confirmDelete(true) }">
                                        <i class="icon-remove"></i></button>
                                    <button class="btn" data-bind="enable: editable, click: $parent.updateRx">
                                        <i class="icon-edit"></i></button>
                                    <button href="#" class="btn" data-bind="click: $parent.applyRx, enable: $parent.selectedFeatures">
                                        <i class="icon-share"></i></button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="btn-group pull-right btn-controls">
                    <a class="btn btn-primary" data-bind="click: addNewRx">add new prescription</a>
                </div>
            </div>
            <div data-bind="visible: newRx">
                <div id="tree-window">
                    <div id="tree-slider"></div>
                </div>
                <p data-bind="visible: decisionOutput"><span data-bind="text: decisionOutput"></span></p>
                <br data-bind="visible: ! decisionOutput()"/>
                <div class="pull-right">
                    <button class='btn btn-large' data-bind="click: function () { newRx(false) }" style="margin-top: 10px">done</button>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="scenario-review-content">
            <div>
                <!--
                TODO: summarize scenario

                <li>X stands with the XX Prescription</li>
                <li>Y stands with the YY Prescription</li>

                <hr>
                -->
                <div class="">
                    {% for hidden in form.hidden_fields %}
                        {{hidden.errors}} 
                        {{hidden}}
                    {% endfor %}

                    {% for field in form.visible_fields %}
                    <div class="control-group">
                        {{field.errors}} 
                        <label for="{{field.auto_id}}" class="control-label"> 
                            <strong>{{ field.label }}</strong><p class="muted">{{field.help_text}}</p></label>
                        <div class="controls">
                        {{ field }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="control-group pull-right">
                <div class="controls">
                    <button class="btn btn-primary submit">Submit Scenario</button>
                </div>
            </div>
        </div>

    </div>
</form>
            <div class="control-group pull-right">
                <div class="controls">
                    <button class="btn cancel">Cancel</button>
                </div>
            </div>
{% endblock panel %}
